angular.module("angular.tourist",[]),angular.module("angular.tourist").directive("tourStep",["$tourist","$window","$injector",function(t,e,n){return{restrict:"EAC",controller:["$scope",function(){var t,i,s;return this.element=null,s=null,i=function(t){if(null==s)for(;"HTML"!==t.parentNode.tagName;){if("fixed"===e.getComputedStyle(t).position){s=!0;break}s=!1,t=t.parentNode}return s},t=function(t){var n,s,r,o;if(null!=t&&(s=t.ownerDocument,r=s.documentElement,n="function"==typeof t.getBoundingClientRect?t.getBoundingClientRect():void 0,o=i(t)?{x:0,y:0}:{x:e.pageXOffset||r.scrollLeft,y:e.pageYOffset||r.scrollTop},null!=n))return{top:n.top+o.y-(r.clientTop||0),left:n.left+o.x-(r.clientLeft||0),width:t.offsetWidth,height:t.offsetHeight}},this.activate=function(t){return function(s){var r,o;return i(t.element[0])?void 0:(r=t.offset(),o={left:r.left+r.width/2-e.innerWidth/2,top:r.top+r.height/2-e.innerHeight/2},s.activated||(s.activated=["scroll",function(t){return e.scrollTo(t.left,t.top)}]),n.invoke(s.activated,t,{scroll:o}))}}(this),this.offset=function(e){return function(){return t(e.element[0])}}(this),this.positioning=function(t){return function(){var e;return e=i(t.element[0])?{position:"fixed"}:{position:"absolute"}}}(this)}],link:function(e,n,i,s){return s.element=n,t.registerStep(i.tourStep,s)}}}]),angular.module("angular.tourist").directive("tourTemplate",["$tourist","$templateCache","$interpolate",function(t,e,n){return e.put("angular/tourist.html",'<div ng-class="styles" ng-if="$show" ng-class="class">No template</div>'),{restrict:"EA",templateUrl:function(t,e){return e.src||"angular/tourist.html"},scope:{templateName:"@tourTemplate","class":"@activeClass"},controller:["$scope",function(t){this.show=function(e,i){return t.$show=!0,t.$pos=angular.extend(e.offset(),e.positioning()),t.$data=i.data,t.$content=n(i.content)(t)},this.hide=function(){return t.$show=!1},this.set=function(e){return angular.forEach(e,function(e,n){return t[n]=e})},this.setTour=function(e){return t.$next=function(){return e.next()},t.$previous=function(){return e.previous()},t.$hasNext=function(){return e.hasNext()},t.$hasPrevious=function(){return e.hasPrevious()},t.$end=function(){return e.end()},t.$isLastStep=function(){return e.isLastStep()}}}],link:function(e,n,i,s){t.registerTemplate(e.templateName,s)}}}]);var Tour,__bind=function(t,e){return function(){return t.apply(e,arguments)}},__indexOf=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};Tour=function(){function t(t,e){this.name=t,this.stepScope=__bind(this.stepScope,this),this.getStep=__bind(this.getStep,this),this.getControllerStepData=__bind(this.getControllerStepData,this),this.setSteps=__bind(this.setSteps,this),this.getController=__bind(this.getController,this),this.getTemplate=__bind(this.getTemplate,this),this.leave=__bind(this.leave,this),this.enter=__bind(this.enter,this),this.showStep=__bind(this.showStep,this),this.setActiveStep=__bind(this.setActiveStep,this),this.emit=__bind(this.emit,this),this.on=__bind(this.on,this),this.activate=__bind(this.activate,this),this.previous=__bind(this.previous,this),this.isLastStep=__bind(this.isLastStep,this),this.hasPrevious=__bind(this.hasPrevious,this),this.hasNext=__bind(this.hasNext,this),this.next=__bind(this.next,this),this.end=__bind(this.end,this),this.start=__bind(this.start,this),this.reset=__bind(this.reset,this),this.options=e,this.reset(),null!=e.enter&&this.on("enter",e.enter),null!=e.leave&&this.on("leave",e.leave),this.on("enter",this.enter),this.on("leave",this.leave),this.options.autostart&&this.start()}return t.PROPS=["content","data"],t.EVT_PROPS=["enter","leave","completed","started"],t.prototype.reset=function(){return this.index=!1,this.activeStep=null,this.lastStep=null},t.prototype.start=function(t){return null==t&&(t=0),this.setSteps(this.options.steps),null==this.activeStep?(this.setActiveStep(t),this.activate(),this.emit("started")):void 0},t.prototype.end=function(){return null!=this.activeStep?(this.emit("leave",this.activeStep),this.getTemplate().hide(),this.emit("complete"),this.reset()):void 0},t.prototype.next=function(){return this.setActiveStep(this.index+1)?this.activate():this.end()},t.prototype.hasNext=function(){return this.index<this.steps.length-1},t.prototype.hasPrevious=function(){return this.index>0},t.prototype.isLastStep=function(){return this.index===this.steps.length-1},t.prototype.previous=function(){return this.setActiveStep(this.index-1)?this.activate():void 0},t.prototype.activate=function(){var t,e,n;return t=null,e=this.getTemplate(),e.set({$transitioning:!0}),null!=this.lastStep&&(t=this.emit("leave",this.lastStep)),n=function(t){return function(){return t.emit("enter",t.activeStep).then(function(){return t.showStep(e),e.set({$transitioning:!1})})}}(this),null!=t?t.then(n):n()},t.prototype.on=function(e,n){var i;return i=this,t.$rootScope.$on("$$tour-"+this.name+"-"+e,function(e,s,r){return t.$injector.invoke(n,i,{$scope:s,$step:r,$event:e})})},t.prototype.emit=function(e,n){var i,s,r,o,u,a,l,h,p,c,f;if(null==n&&(n=null),i=null,l=[],n&&(i=this.stepScope(n),r=n[e]))for(h=0,c=r.length;c>h;h++)s=r[h],a=null!=s.$$tourParsed?s(i):t.$injector.invoke(s,this,{$scope:i,$step:n,$element:this.getController(n).element}),l.push(a);for(t.$rootScope.$emit("$$tour-"+this.name+"-"+e,i,n),o=[],p=0,f=l.length;f>p;p++)a=l[p],null!=a&&null!=a.then?o.push(a):(u=t.$q.defer(),u.resolve(a),o.push(u.promise));return t.$q.all(o)},t.prototype.setActiveStep=function(t){return t>=this.steps.length?this.index=null:t>=0?(this.index!==!1&&(this.lastStep=this.getStep(this.index)),this.index=t,this.activeStep=this.getStep(t),!0):void 0},t.prototype.showStep=function(t){var e;return e=this.getController(),t.show(e,this.activeStep),e.activate(this.activeStep)},t.prototype.enter=function(){var t;return t=this.getController().element,null!=this.activeStep.activeClass&&t.addClass(this.activeStep.activeClass),"static"===t.css("position")?t.css("position","relative"):void 0},t.prototype.leave=function(){var t;return t=this.getController(this.lastStep).element,null!=this.activeStep.activeClass&&t.removeClass(this.activeStep.activeClass),t.css({position:""})},t.prototype.getTemplate=function(){var e,n;return n=this.activeStep.template,"function"==typeof n&&(n=n(this)),e=t.templates[n||"default"],e.setTour(this),e},t.prototype.getController=function(e){return null==e&&(e=this.activeStep),t.controllers[e["for"]]},t.prototype.setSteps=function(e){var n,i,s,r,o,u;for(this.steps=[],n=this.options.stepDefault||{},o=0,u=e.length;u>o;o++)r=e[o],i=this.getControllerStepData(r),s=angular.extend({},n,r),angular.forEach(t.EVT_PROPS,function(t){var e;return e=s[t],s[t]=[],null!=e&&s[t].push(e),null!=i[t]&&s[t].push(i[t]),delete i[t]}),angular.extend(s,i),null!=n.data&&(s.data=angular.extend({},n.data,r.data,i.data)),this.steps.push(s)},t.prototype.getControllerStepData=function(e){var n,i,s,r,o;return i=this.getController(e),null==i?{}:(s=i.element,r=s.scope(),o={},n=t.$parse,angular.forEach(t.PROPS.concat(t.EVT_PROPS),function(){return function(e){var i;if(i=s.attr("tour-"+e))return __indexOf.call(t.EVT_PROPS,e)>=0?(i=n(i),i.$$tourParsed=!0):"data"===e&&(i=r.$eval(i)),o[e]=i}}(this)),o)},t.prototype.getStep=function(t){return null==t&&(t=this.index),this.steps[this.index]},t.prototype.stepScope=function(t){return angular.element(this.getController(t).element).scope()},t}(),angular.module("angular.tourist").provider("$tourist",function(){var t,e,n;n={},t={},e={},this.define=function(t,e){"object"==typeof t&&(e=t,t="default"),n[t]=e},this.$get=["$rootScope","$parse","$injector","$q",function(i,s,r,o){var u;return u={},Tour.$rootScope=i,Tour.$parse=s,Tour.$injector=r,Tour.controllers=t,Tour.templates=e,Tour.$q=o,{get:function(i){if(null==i&&(i="default"),null==n[i])throw"You have not defined a tour configuration for "+i+"!";if(0===e.length)throw"You have not defined any templates for the tour!";if(0===t.length)throw"You have not defined any steps for the tour!";return u[i]||(u[i]=new Tour(i,n[i]))},registerStep:function(e,n){return t[e]=n},registerTemplate:function(t,n){return"object"==typeof t&&(n=t,t="default"),e[t||"default"]=n}}}]});