angular.module("angular.tourist",[]),angular.module("angular.tourist").directive("tourStep",["$tourist","$window","$injector",function(t,e,i){return{restrict:"EAC",controller:["$scope",function(){var t;return this.element=null,t=function(t){var i,n,s;if(null!=t&&(n=t.ownerDocument,s=n.documentElement,i="function"==typeof t.getBoundingClientRect?t.getBoundingClientRect():void 0,null!=i))return{top:i.top+(e.pageYOffset||s.scrollTop)-(s.clientTop||0),left:i.left+(e.pageXOffset||s.scrollLeft)-(s.clientLeft||0),width:t.offsetWidth,height:t.offsetHeight}},this.activate=function(t){return function(n){var s,r;return s=t.offset(),r={left:s.left+s.width/2-e.innerWidth/2,top:s.top+s.height/2-e.innerHeight/2},n.activated||(n.activated=["scroll",function(t){return e.scrollTo(t.left,t.top)}]),i.invoke(n.activated,t,{scroll:r})}}(this),this.offset=function(e){return function(){return t(e.element[0])}}(this)}],link:function(e,i,n,s){return s.element=i,t.registerStep(n.tourStep,s)}}}]),angular.module("angular.tourist").directive("tourTemplate",["$tourist","$templateCache","$interpolate",function(t,e,i){return e.put("angular/tourist.html",'<div ng-class="styles" ng-if="$show" ng-class="class">No template</div>'),{restrict:"EA",templateUrl:function(t,e){return e.src||"angular/tourist.html"},scope:{templateName:"@tourTemplate","class":"@activeClass"},controller:["$scope",function(t){this.show=function(e,n){return t.$show=!0,t.$pos=angular.extend(e.offset(),{position:"absolute"}),t.$data=n.data,t.$content=i(n.content)(t)},this.hide=function(){return t.$show=!1},this.setTour=function(e){return t.$next=function(){return e.next()},t.$previous=function(){return e.previous()},t.$hasNext=function(){return e.hasNext()},t.$hasPrevious=function(){return e.hasPrevious()},t.$end=function(){return e.end()},t.$isLastStep=function(){return e.isLastStep()}}}],link:function(e,i,n,s){t.registerTemplate(e.templateName,s)}}}]);var Tour,__bind=function(t,e){return function(){return t.apply(e,arguments)}},__indexOf=[].indexOf||function(t){for(var e=0,i=this.length;i>e;e++)if(e in this&&this[e]===t)return e;return-1};Tour=function(){function t(t,e){this.name=t,this.stepScope=__bind(this.stepScope,this),this.getStep=__bind(this.getStep,this),this.getControllerStepData=__bind(this.getControllerStepData,this),this.setSteps=__bind(this.setSteps,this),this.getController=__bind(this.getController,this),this.getTemplate=__bind(this.getTemplate,this),this.leave=__bind(this.leave,this),this.enter=__bind(this.enter,this),this.showStep=__bind(this.showStep,this),this.setActiveStep=__bind(this.setActiveStep,this),this.emit=__bind(this.emit,this),this.on=__bind(this.on,this),this.activate=__bind(this.activate,this),this.previous=__bind(this.previous,this),this.isLastStep=__bind(this.isLastStep,this),this.hasPrevious=__bind(this.hasPrevious,this),this.hasNext=__bind(this.hasNext,this),this.next=__bind(this.next,this),this.end=__bind(this.end,this),this.start=__bind(this.start,this),this.reset=__bind(this.reset,this),this.options=e,this.reset(),null!=e.enter&&this.on("enter",e.enter),null!=e.leave&&this.on("leave",e.leave),this.on("enter",this.enter),this.on("leave",this.leave),this.options.autostart&&this.start()}return t.PROPS=["content","data"],t.EVT_PROPS=["enter","leave","completed","started"],t.prototype.reset=function(){return this.index=!1,this.activeStep=null,this.lastStep=null},t.prototype.start=function(t){return null==t&&(t=0),this.setSteps(this.options.steps),null==this.activeStep?(this.setActiveStep(t),this.activate(),this.emit("started")):void 0},t.prototype.end=function(){return null!=this.activeStep?(this.emit("leave",this.activeStep),this.getTemplate().hide(),this.emit("complete"),this.reset()):void 0},t.prototype.next=function(){return this.setActiveStep(this.index+1)?this.activate():this.end()},t.prototype.hasNext=function(){return this.index<this.steps.length-1},t.prototype.hasPrevious=function(){return this.index>0},t.prototype.isLastStep=function(){return this.index===this.steps.length-1},t.prototype.previous=function(){return this.setActiveStep(this.index-1)?this.activate():void 0},t.prototype.activate=function(){var t,e;return t=null,null!=this.lastStep&&(t=this.emit("leave",this.lastStep)),e=function(t){return function(){return t.emit("enter",t.activeStep).then(function(){return t.showStep()})}}(this),null!=t?t.then(e):e()},t.prototype.on=function(e,i){var n;return n=this,t.$rootScope.$on("$$tour-"+this.name+"-"+e,function(e,s,r){return t.$injector.invoke(i,n,{$scope:s,$step:r,$event:e})})},t.prototype.emit=function(e,i){var n,s,r,o,u,a,l,h,p,c,f;if(null==i&&(i=null),n=null,l=[],i&&(n=this.stepScope(i),r=i[e]))for(h=0,c=r.length;c>h;h++)s=r[h],a=null!=s.$$tourParsed?s(n):t.$injector.invoke(s,this,{$scope:n,$step:i,$element:this.getController(i).element}),l.push(a);for(t.$rootScope.$emit("$$tour-"+this.name+"-"+e,n,i),o=[],p=0,f=l.length;f>p;p++)a=l[p],null!=a&&null!=a.then?o.push(a):(u=t.$q.defer(),u.resolve(a),o.push(u.promise));return t.$q.all(o)},t.prototype.setActiveStep=function(t){return t>=this.steps.length?this.index=null:t>=0?(this.index!==!1&&(this.lastStep=this.getStep(this.index)),this.index=t,this.activeStep=this.getStep(t),!0):void 0},t.prototype.showStep=function(){var t,e;return e=this.getTemplate(),e.setTour(this),t=this.getController(),e.show(t,this.activeStep),t.activate(this.activeStep)},t.prototype.enter=function(){var t;return t=this.getController().element,null!=this.activeStep.activeClass&&t.addClass(this.activeStep.activeClass),"static"===t.css("position")&&t.css("position","relative"),t.css("z-index",this.activeStep.zIndex+1||1001)},t.prototype.leave=function(){var t;return t=this.getController(this.lastStep).element,null!=this.activeStep.activeClass&&t.removeClass(this.activeStep.activeClass),t.css({"z-index":"",position:""})},t.prototype.getTemplate=function(){return t.templates[this.activeStep.template||"default"]},t.prototype.getController=function(e){return null==e&&(e=this.activeStep),t.controllers[e["for"]]},t.prototype.setSteps=function(e){var i,n,s,r,o,u;for(this.steps=[],i=this.options.stepDefault||{},o=0,u=e.length;u>o;o++)r=e[o],n=this.getControllerStepData(r),s=angular.extend({},i,r),angular.forEach(t.EVT_PROPS,function(t){var e;return e=s[t],s[t]=[],null!=e&&s[t].push(e),null!=n[t]&&s[t].push(n[t]),delete n[t]}),angular.extend(s,n),null!=i.data&&(s.data=angular.extend({},i.data,r.data,n.data)),this.steps.push(s)},t.prototype.getControllerStepData=function(e){var i,n,s,r,o;return n=this.getController(e),null==n?{}:(s=n.element,r=s.scope(),o={},i=t.$parse,angular.forEach(t.PROPS.concat(t.EVT_PROPS),function(){return function(e){var n;if(n=s.attr("tour-"+e))return __indexOf.call(t.EVT_PROPS,e)>=0?(n=i(n),n.$$tourParsed=!0):"data"===e&&(n=r.$eval(n)),o[e]=n}}(this)),o)},t.prototype.getStep=function(t){return null==t&&(t=this.index),this.steps[this.index]},t.prototype.stepScope=function(t){return angular.element(this.getController(t).element).scope()},t}(),angular.module("angular.tourist").provider("$tourist",function(){var t,e,i;i={},t={},e={},this.define=function(t,e){"object"==typeof t&&(e=t,t="default"),i[t]=e},this.$get=["$rootScope","$parse","$injector","$q",function(n,s,r,o){var u;return u={},Tour.$rootScope=n,Tour.$parse=s,Tour.$injector=r,Tour.controllers=t,Tour.templates=e,Tour.$q=o,{get:function(n){if(null==n&&(n="default"),null==i[n])throw"You have not defined a tour configuration for "+n+"!";if(0===e.length)throw"You have not defined any templates for the tour!";if(0===t.length)throw"You have not defined any steps for the tour!";return u[n]||(u[n]=new Tour(n,i[n]))},registerStep:function(e,i){return t[e]=i},registerTemplate:function(t,i){return"object"==typeof t&&(i=t,t="default"),e[t||"default"]=i}}}]});